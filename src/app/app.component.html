<nav class="navbar navbar-expand-lg navbar-dark bg-dark px-4">
  <a class="navbar-brand">DeckSet</a>

  <div class="collapse navbar-collapse justify-content-between">
    @if(!loadingPage()) {
    <ul class="navbar-nav mr-auto">
      <li class="nav-item">
        <button class="btn btn-outline-success my-2 my-sm-0" (click)="fetchData()" [disabled]="loadingData()">Fetch Card
          Data</button>
      </li>

      @if(updatedAt(); as updatedAt) {
      <li class="nav-item">
        <a class="nav-link disabled" href="#">Updated at: {{ updatedAt | date }} ({{ totalCards() | number }} cards)</a>
      </li>
      }

      @else {
      <li class="nav-item">
        <a class="nav-link disabled" href="#">Data not fetched.</a>
      </li>
      }
    </ul>
    }
  </div>
</nav>

@if(!loadingPage()) {
<div class="container py-4">
  <div class="row">
    @if(shouldShowDeck()) {
    <div class="col-6">
      <h2>Deck List</h2>
      <textarea class="form-control" rows="15" [(ngModel)]="deckString" (ngModelChange)="saveDeck($event)"></textarea>
    </div>
    }

    <div class="col">
      <h2 class="d-flex align-items-center">
        Card List

        <div class="btn-group ms-3">
          @for(sortType of ['Set', 'Color', 'Rarity', 'Type']; track $index) {
          <button type="button" class="btn btn-sm" (click)="setSort(sortType)"
            [class.btn-secondary]="sort() !== sortType" [class.btn-info]="sort() === sortType">
            {{ sortType }}
          </button>
          }
        </div>

        <div class="btn-group ms-3">
          @for(sortType of ['AZ', 'Qty']; track $index) {
          <button type="button" class="btn btn-sm" (click)="setBoxSort(sortType)"
            [class.btn-secondary]="boxSort() !== sortType" [class.btn-info]="boxSort() === sortType">
            {{ sortType }}
          </button>
          }
        </div>

        <div class="btn-group ms-3">
          @for(sortType of ['Asc', 'Desc']; track $index) {
          <button type="button" class="btn btn-sm" (click)="setBoxOrder(sortType)"
            [class.btn-secondary]="boxOrder() !== sortType" [class.btn-info]="boxOrder() === sortType">
            {{ sortType }}
          </button>
          }
        </div>

        @if(boxSort() === 'Qty') {
        <button class="btn ms-3 btn-sm" [class.btn-outline-info]="!considerUnfound()"
          [class.btn-info]="considerUnfound()" (click)="toggleConsiderUnfound()">
          {{ considerUnfound() ? '☑' : '☐' }} Consider Unfound
        </button>
        }
      </h2>

      <div class="row my-3">
        <div class="col">
          <em>{{ totalUniqueCards() }} cards in deck; {{ incompleteCards() }} cards to go</em>

          <button class="btn ms-3 btn-sm" [class.btn-outline-info]="!deckToggle()" [class.btn-info]="deckToggle()"
            (click)="toggleDeckBox()">
            {{ deckToggle() ? '☑' : '☐' }} Show Deck
          </button>

          <button class="btn ms-3 btn-sm" [class.btn-outline-info]="!hideComplete()" [class.btn-info]="hideComplete()"
            (click)="toggleHideComplete()">
            {{ hideComplete() ? '☑' : '☐' }} Hide Complete
          </button>

          <button class="btn ms-3 btn-sm" [class.btn-outline-info]="!hideClosed()" [class.btn-info]="hideClosed()"
            (click)="toggleHideClosed()">
            {{ hideClosed() ? '☑' : '☐' }} Hide Closed
          </button>
        </div>
      </div>

      @if(unfoundCards().length > 0) {
      <div class="row my-3">
        <div class="col">
          <em>{{ unfoundCards().length }} unfound cards: </em>

          @for(card of unfoundCards(); track $index) {
          <span class="unfound badge bg-danger">{{ card.name }}</span>
          }
        </div>
      </div>
      }

      <div class="row">
        @for(set of orderedSets(); track $index) {
        @let isComplete = isSetComplete(set);

        <div class="col-4 my-2" [class.hidden]="(isComplete && hideComplete()) || (closedBoxes[set] && hideClosed())">
          <div class="card" [class.text-white]="isComplete || set === 'Unfound'" [class.bg-success]="isComplete"
            [class.bg-warning]="closedBoxes[set]" [class.bg-danger]="set === 'Unfound'">
            <div class="card-body">
              <h5 class="card-title">
                {{ set }}

                ({{ setFound(set) }}/{{ setTotal(set) }} Found)
                <button class="btn btn-sm float-end" [class.btn-outline-info]="closedBoxes[set]"
                  [class.btn-outline-warning]="!closedBoxes[set]" (click)="toggleBoxClosed(set)">
                  &times;
                </button>
              </h5>

              <div class="card-text">
                <ul>
                  @for(card of getOrderedCardsFromSet(set); track card.name) {
                  <li>
                    @for(input of checkList[card.name]; track $index) {
                    <input class="form-check-input" type="checkbox" [checked]="checkList[card.name][$index]()"
                      (click)="toggleCollectionCard(card.name, $index)">
                    }

                    {{ card.name }}
                  </li>
                  }
                </ul>
              </div>
            </div>
          </div>
        </div>
        }
      </div>
    </div>
  </div>
</div>
}

@else {
<div class="container py-4 loading-container">
  <div class="spinner-border">
  </div>
</div>
}